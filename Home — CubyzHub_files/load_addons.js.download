
async function loadAddons() {
    try {
        const res = await fetch('/api/addons');
        const json = await res.json();
        const container = document.getElementById('addon-container');
        container.innerHTML = '';

        document.getElementById('empty-state').style.display = 'none';

        if (!json.ok || !json.addons || json.addons.length === 0) return;

        json.addons.forEach(addon => {
            let tagsArray = [];
            try {
                tagsArray = Array.isArray(addon.tags)
                    ? addon.tags
                    : JSON.parse(addon.tags || '[]');
            } catch {
                tagsArray = [];
            }

            const tagsHTML = tagsArray
                .slice(0, 6)
                .map(t => `<span class="tag">${t}</span>`)
                .join('');

            const card = document.createElement('article');
            card.className = 'addon-card';

            card.innerHTML = `
  <div class="addon-banner" style="background-image:url('${addon.bannerUrl || 'assets/default_banner.png'}')"></div>
  <div class="addon-icon"><img src="${addon.iconUrl || 'assets/default_icon.png'}" alt="icon"></div>
  <div class="addon-info">
    <h3 class="addon-title">${addon.name}</h3>
    <p class="addon-desc">${addon.description || ''}</p>
    <div class="addon-tags">${tagsHTML}</div>
    <div class="addon-meta">
      <a class="view-addon-btn" href="addon.html?id=${addon.id}">View Addon</a>
    </div>

  </div>
`;

            container.appendChild(card);
        });
    } catch (err) {
        console.error('Failed to load addons', err);
    }
}

window.addEventListener('DOMContentLoaded', loadAddons);
